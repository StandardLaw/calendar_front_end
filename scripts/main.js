!function(e,a,t,n){"use strict";function r(e){return a.getElementById(e).innerHTML}function o(e){return e.toLowerCase().split(" ").join("-")}function i(e){return e.map(function(e){return{title:e.title,start:moment(e.start_date),end:moment(e.end_date),url:e.url,editable:!1,startEditable:!1,durationEditable:!1,className:o(e.organizer)}})}function l(e){return e.split(" ").map(function(e){return 0===e.toLowerCase().indexOf("http")?'<a href="'+e+'" target="_blank">'+e+"</a>":e}).join(" ")}function d(e,a){return e.filter(function(e){var t=moment(e.start_date),n=moment(e.end_date);return t.dayOfYear()===a.dayOfYear()||n.dayOfYear()===a.dayOfYear()?!0:t.dayOfYear()<=a.dayOfYear()&&n.dayOfYear()>=a.dayOfYear()?!0:!1})}function c(e){var a,t=moment(e.start_date),n=moment(e.end_date);return a=t.format("L")===n.format("L")?t.fromNow()+" | "+t.format("L"):t.format("L")+" - "+n.format("L"),{title:e.title,dateString:a,location:e.location,description:l(e.description)}}var s={EVENTS:"https://boston-civic-calendar.herokuapp.com/api/v1/events",NEW_SOURCE:"https://boston-civic-calendar.herokuapp.com/sources/new"},u=t(a),f={$tooltips:t('[data-toggle="tooltip"]'),$newSourceLink:t('[data-hook="new-source-link"]'),$main:t("[data-hook=main]"),$eventsPanel:t("[data-hook=events-panel]"),$errorPanel:t("[data-hook=error-panel]"),$calendarList:t('[data-hook="list-container"]'),$calendar:t('[data-hook="calendar-container"]'),$calendarDetail:t('[data-hook="calendar-detail"]'),$calendarDetailList:t('[data-hook="calendar-detail-events-list"]'),$hideDetail:t('[data-hook="hide-detail"]')},m={calendarList:n.template(r("calendar-list"))};f.$tooltips.tooltip(),f.$newSourceLink.attr("href",s.NEW_SOURCE),t.getJSON(s.EVENTS).error(function(e){console.log(e),f.$errorPanel.removeClass("hidden")}).done(function(e){f.$eventsPanel.removeClass("hidden");var a=i(e);f.$calendar.fullCalendar({events:a,theme:!1,aspectRatio:2,dayClick:function(a){var t=d(e,a);u.trigger("calendarDetail:show",{events:t})},eventClick:function(){console.log("handle event click. show single event in pane?")}});var t={events:n.map(e,c)},r=m.calendarList(t);f.$calendarList.append(r)}),u.on("calendarDetail:show",function(e,a){var t={events:n.map(a.events,c)},r=m.calendarList(t);f.$calendarDetailList.html(r),f.$calendarDetail.removeClass("hidden")}),u.on("calendarDetail:hide",function(){f.$calendarDetail.addClass("hidden")}),f.$hideDetail.on("click",function(){u.trigger("calendarDetail:hide")})}(window,document,$,_);